@using Gui.Models
@using Gui.Models.DTO
@using Gui.Services
@using Newtonsoft.Json
@inject FilterService filterService
@inject HttpClient client
@inject SweetAlertService Swal


<header class="header" id="headMenu">
    <button class="btn btn-menu" @onclick="ShowSideBar">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="24" fill="currentColor" class="icon" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
        </svg>
    </button>
    <p class="menuTitle">@ActiveTitle</p>
</header>




<div class="l-navbar @SideBar" id="nav-bar" @onclick="ShowSideBar">
    <nav class="nav">
        <div>
            <a href="/" class="nav_logo" style="margin: 5% 0 20% 0" @onclick=@(() => ClickLink(1))>
                <svg id="_Слой_1" data-name="Слой 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="50" style="margin: 10% 0 7px 35%" viewBox="0 0 1658 1482.59">
                    <defs>
                        <style>
                            .cls-1 {
                                fill: url(#_Безымянный_градиент_1206);
                            }

                            .cls-2 {
                                fill: url(#_Безымянный_градиент_690);
                            }

                            .cls-3 {
                                opacity: .23;
                            }

                            .cls-3, .cls-4 {
                                fill: #fff;
                            }

                            .cls-5 {
                                fill: url(#_Безымянный_градиент_1072);
                            }

                            .cls-4 {
                                stroke: #352eb3;
                                stroke-miterlimit: 10;
                            }
                        </style>
                        <linearGradient id="_Безымянный_градиент_690" data-name="Безымянный градиент 690" x1="274.86" y1="230.07" x2="873.41" y2="230.07" gradientUnits="userSpaceOnUse">
                            <stop offset="0" stop-color="#fff" />
                            <stop offset=".06" stop-color="#fff" stop-opacity=".86" />
                            <stop offset=".17" stop-color="#fff" stop-opacity=".62" />
                            <stop offset=".27" stop-color="#fff" stop-opacity=".44" />
                            <stop offset=".36" stop-color="#fff" stop-opacity=".3" />
                            <stop offset=".43" stop-color="#fff" stop-opacity=".22" />
                            <stop offset=".48" stop-color="#fff" stop-opacity=".19" />
                            <stop offset=".65" stop-color="#fff" stop-opacity=".09" />
                            <stop offset=".81" stop-color="#fff" stop-opacity=".02" />
                            <stop offset=".93" stop-color="#fff" stop-opacity="0" />
                        </linearGradient>
                        <linearGradient id="_Безымянный_градиент_1206" data-name="Безымянный градиент 1206" x1="120.67" y1="610.51" x2="1612.91" y2="-24.92" gradientUnits="userSpaceOnUse">
                            <stop offset="0" stop-color="#fff" stop-opacity=".73" />
                            <stop offset=".46" stop-color="#fff" stop-opacity=".35" />
                            <stop offset=".47" stop-color="#fff" stop-opacity=".33" />
                            <stop offset=".56" stop-color="#fff" stop-opacity=".21" />
                            <stop offset=".65" stop-color="#fff" stop-opacity=".12" />
                            <stop offset=".75" stop-color="#fff" stop-opacity=".05" />
                            <stop offset=".86" stop-color="#fff" stop-opacity=".01" />
                            <stop offset="1" stop-color="#fff" stop-opacity="0" />
                        </linearGradient>
                        <linearGradient id="_Безымянный_градиент_1072" data-name="Безымянный градиент 1072" x1="-430.94" y1="-852.63" x2="904.05" y2="1538.21" gradientUnits="userSpaceOnUse">
                            <stop offset=".49" stop-color="#fff" stop-opacity="0" />
                            <stop offset=".53" stop-color="#fff" stop-opacity=".06" />
                            <stop offset=".63" stop-color="#fff" stop-opacity=".23" />
                            <stop offset=".69" stop-color="#fff" stop-opacity=".29" />
                            <stop offset=".69" stop-color="#fff" stop-opacity=".29" />
                            <stop offset=".71" stop-color="#fff" stop-opacity=".4" />
                            <stop offset=".73" stop-color="#fff" stop-opacity=".48" />
                            <stop offset=".76" stop-color="#fff" stop-opacity=".54" />
                            <stop offset=".8" stop-color="#fff" stop-opacity=".57" />
                            <stop offset=".85" stop-color="#fff" stop-opacity=".58" />
                            <stop offset=".89" stop-color="#fff" stop-opacity=".68" />
                            <stop offset=".96" stop-color="#fff" stop-opacity=".84" />
                            <stop offset="1" stop-color="#fff" stop-opacity=".9" />
                        </linearGradient>
                    </defs>
                    <path class="cls-2" d="M873.41,0c-254.9,68.33-468.81,236.57-597.39,460.14-.75-15.92-1.17-31.92-1.17-48,0-86,11-169.32,31.83-248.82l43.91-76.08C381.77,33.25,439.44,0,501.77,0h371.65Z" />
                    <path class="cls-1" d="M1454.89,342.82c-101.91-36.08-211.66-55.66-325.9-55.66-335.07,0-630.89,168.32-807.38,425.15-25.75-80.08-41.41-164.58-45.58-252.15C404.6,236.57,618.51,68.33,873.41,0h282.82c62.33,0,119.99,33.25,151.16,87.25l147.49,255.57Z" />
                    <path class="cls-3" d="M1634.63,828.54l-326.57,565.64c-16.5,.83-33.16,1.25-49.91,1.25-438.39,0-809.71-286.82-936.54-683.13,176.49-256.82,472.31-425.15,807.38-425.15,114.24,0,223.99,19.58,325.9,55.66l179.74,311.23c31.17,54,31.17,120.49,0,174.49Z" />
                    <path class="cls-5" d="M1308.06,1394.18l-.67,1.17c-31.17,54-88.83,87.25-151.16,87.25H501.77c-62.33,0-119.99-33.25-151.16-87.25l-182.74-316.48-17.17-29.83L23.37,828.54c-31.17-54-31.17-120.49,0-174.49L306.69,163.33c-20.83,79.5-31.83,162.82-31.83,248.82,0,16.08,.42,32.08,1.17,48,4.17,87.58,19.83,172.07,45.58,252.15,126.83,396.31,498.14,683.13,936.54,683.13,16.75,0,33.42-.42,49.91-1.25Z" />
                    <path class="cls-4" d="M454.02,350.4h342.07c77.14,0,135.94,5.35,176.41,15.99,54.38,14.48,100.93,40.18,139.74,77.08,38.77,36.93,68.29,82.12,88.52,135.61,20.23,53.46,30.35,119.42,30.35,197.81,0,68.9-9.48,128.28-28.45,178.13-23.2,60.91-56.27,110.19-99.27,147.87-32.48,28.55-76.31,50.81-131.52,66.8-41.33,11.81-96.54,17.7-165.66,17.7H454.02V350.4Zm187.16,141.59v554.38h139.74c52.25,0,89.99-2.64,113.18-7.99,30.35-6.85,55.54-18.45,75.54-34.83,20.03-16.35,36.37-43.3,49.02-80.77,12.65-37.5,18.97-88.59,18.97-153.31s-6.32-114.37-18.97-149.01c-12.65-34.62-30.35-61.66-53.11-81.07-22.76-19.41-51.65-32.54-86.62-39.39-26.16-5.32-77.37-7.99-153.65-7.99h-84.1Z" />
                </svg>
                <i class='bx bx-layer nav_logo-icon'></i>
                <span class="nav_logo-name" style="margin-left: 12px" >DuplicateFilter</span>
            </a>
            <div class="nav_list">
                @foreach (var item in Elements)
                {
                    <a href="@item.Link" class="nav_link @item.IsActive" @onclick=@(() => ClickLink(item.Id)) style="align-content:center">
                        <div style="display:flex; align-items:center">
                            <svg style="margin-right: 10px" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                @foreach (var svgItem in item.svg)
                                {
                                    <path d=@svgItem />
                                }
                            </svg>
                            <i class='bx bx-grid-alt nav_icon'></i>
                            <span class="nav_name">@item.Name</span>
                        </div>
                    </a>
                }
                <hr size=4px width=84% style="margin: 0 8% 13% 8%; color:azure">
                
                @*================ Сохранение ================*@
                <a class="addNav_link" @onclick=Save style="align-content:center">
                    <div style="display:flex; align-items:center">
                        <svg style="margin-right: 10px; margin-left: 10%" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M6.598 5.013a.144.144 0 0 1 .202.134V6.3a.5.5 0 0 0 .5.5c.667 0 2.013.005 3.3.822.984.624 1.99 1.76 2.595 3.876-1.02-.983-2.185-1.516-3.205-1.799a8.74 8.74 0 0 0-1.921-.306 7.404 7.404 0 0 0-.798.008h-.013l-.005.001h-.001L7.3 9.9l-.05-.498a.5.5 0 0 0-.45.498v1.153c0 .108-.11.176-.202.134L2.614 8.254a.503.503 0 0 0-.042-.028.147.147 0 0 1 0-.252.499.499 0 0 0 .042-.028l3.984-2.933zM7.8 10.386c.068 0 .143.003.223.006.434.02 1.034.086 1.7.271 1.326.368 2.896 1.202 3.94 3.08a.5.5 0 0 0 .933-.305c-.464-3.71-1.886-5.662-3.46-6.66-1.245-.79-2.527-.942-3.336-.971v-.66a1.144 1.144 0 0 0-1.767-.96l-3.994 2.94a1.147 1.147 0 0 0 0 1.946l3.994 2.94a1.144 1.144 0 0 0 1.767-.96v-.667z" />
                            
                        </svg>
                        <i class='bx bx-grid-alt nav_icon'></i>
                        <span class="nav_name">Сохранить фильтр</span>
                    </div>
                </a>

                @*================ Загрузка ================*@
                <a class="addNav_link" @onclick=Load style="align-content:center">
                    <div style="display:flex; align-items:center">
                        <svg style="margin-right: 10px; margin-left: 10%" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                            <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                        </svg>
                        <i class='bx bx-grid-alt nav_icon'></i>
                        <span class="nav_name">Загрузить фильтр</span>
                    </div>
                </a>
            </div>
        </div>
    </nav>
</div>

@code {

    private bool SideBarShow = false;
    private string? SideBar => SideBarShow ? "show" : null;
    private string ActiveTitle = "Информация";

    private List<MenuElement> Elements = new List<MenuElement>(){
        new MenuElement{
            Id = 1,
            Name = "Информация",
            IsActive = "active",
            Link = "/",
            svg = new List<string>(){
                "m9.708 6.075-3.024.379-.108.502.595.108c.387.093.464.232.38.619l-.975 4.577c-.255 1.183.14 1.74 1.067 1.74.72 0 1.554-.332 1.933-.789l.116-.549c-.263.232-.65.325-.905.325-.363 0-.494-.255-.402-.704l1.323-6.208Zm.091-2.755a1.32 1.32 0 1 1-2.64 0 1.32 1.32 0 0 1 2.64 0Z"
            }
        },
        new MenuElement{
            Id = 2,
            Name = "Таблица сообщений",
            IsActive = null,
            Link = "/messages",
            svg = new List<string>(){
                "M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"
            }
        },
        new MenuElement{
            Id = 3,
            Name = "Диаграммы",
            IsActive = null,
            Link = "/diagramms",
            svg = new List<string>(){
                "M15.985 8.5H8.207l-5.5 5.5a8 8 0 0 0 13.277-5.5zM2 13.292A8 8 0 0 1 7.5.015v7.778l-5.5 5.5zM8.5.015V7.5h7.485A8.001 8.001 0 0 0 8.5.015z"
            }
        },
        new MenuElement{
            Id = 4,
            Name = "Добавление",
            IsActive = null,
            Link = "/add",
            svg = new List<string>(){
                "M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"
            }
        }
    };

    private void ShowSideBar()
    {
        SideBarShow = !SideBarShow;
    }

    private async Task<bool> SaveAction(){
        var response = await filterService.SaveAsync<ResponseDTO>();
        if (response != null)
        {
            string saveResult = response.Result.ToString();
            return saveResult == "True" ? true : false;
        }
        else
        {
            return false;
        }
    }

    private async Task<bool> LoadAction(){
        var response = await filterService.LoadAsync<ResponseDTO>();
        if (response != null)
        {
            string loadResult = response.Result.ToString();
            return loadResult == "True" ? true : false;
        }
        else
        {
            return false;
        }

    }

    private void ClickLink(int id)
    {
        foreach (var item in Elements)
        {
            item.IsActive = item.Id == id ? "active" : null;
            if (item.Id == id)
            {
                item.IsActive = "active";
                ActiveTitle = item.Name;
            }
            else
            {
                item.IsActive = null;
            }
        }
    }

    private async void Save(){
            Swal.FireAsync(new SweetAlertOptions {
                    Title = "Идет сохранение фильтра...",
                    TimerProgressBar = true,
                    ShowConfirmButton = false,
                    DidOpen = new SweetAlertCallback(() => { Swal.ShowLoadingAsync(); }),
                    });

            var result = await SaveAction();
            await Swal.CloseAsync();

            if(result){
                await Swal.FireAsync(new SweetAlertOptions
                    {
                        Title = "Фильтр успешно сохранен!",
                        Icon = SweetAlertIcon.Success,
                        ShowConfirmButton = false,
                        Timer = 1500
                });
            }else{
                await Swal.FireAsync(new SweetAlertOptions
                {
                    Title = "Произошла неизвестная ошибка!",
                    Icon = SweetAlertIcon.Error,
                    ShowConfirmButton = false,
                    Timer = 1500
                });
            }
    }

    private async void Load(){
        Swal.FireAsync(new SweetAlertOptions
            {
                Title = "Идет загрузка фильтра...",
                TimerProgressBar = true,
                ShowConfirmButton = false,
                DidOpen = new SweetAlertCallback(() => { Swal.ShowLoadingAsync(); }),
            });

        var result = await LoadAction();
        await Swal.CloseAsync();

        if (result)
        {
            await Swal.FireAsync(new SweetAlertOptions
                {
                    Title = "Фильтр успешно загружен!",
                    Icon = SweetAlertIcon.Success,
                    ShowConfirmButton = false,
                    Timer = 1500
                });
        }
        else
        {
            await Swal.FireAsync(new SweetAlertOptions
                {
                    Title = "Произошла неизвестная ошибка!",
                    Icon = SweetAlertIcon.Error,
                    ShowConfirmButton = false,
                    Timer = 1500
                });
        }
    }
}
